<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<style type="text/css">
body, html,#allmap {width: 100%;height: 100%;overflow: hidden;margin:0;}
</style>
<script type="text/javascript" src="http://api.map.baidu.com/api?v=1.5&ak=sDyHwPiy2iq5YMuwnZ7gVIvu"></script>
<script type="text/javascript" src="http://api.map.baidu.com/library/TextIconOverlay/1.2/src/TextIconOverlay_min.js"></script>
<script type="text/javascript" src="http://api.map.baidu.com/library/MarkerClusterer/1.2/src/MarkerClusterer_min.js"></script>
<title>点聚合</title>
</head>
<body>
<div id="allmap"></div>
</body>
</html>
<script type="text/javascript">

// 百度地图API功能
var map = new BMap.Map("allmap");
map.centerAndZoom("北京", 10);
map.enableScrollWheelZoom();

var pmdata = "{" +
	"\"pmdata\" :" +
	"[" +
		"{ \"x\":\"116.402437\",	\"y\":\"39.942111\",	\"name\":\"地安门\",	\"pm25\":256 }," +
		"{ \"x\":\"116.379296\",	\"y\":\"39.939013\",	\"name\":\"平安里\",	\"pm25\":188 }," +
		"{ \"x\":\"116.418462\",	\"y\":\"39.922028\",	\"name\":\"王府井\",	\"pm25\":158 }," +
	"]" +
"}";

var jsonObj = eval ("(" + pmdata + ")");

var markers = [];
var pt = null;
for (var i = 0; i < jsonObj.pmdata.length; i++) {
   pt = new BMap.Point(jsonObj.pmdata[i].x, jsonObj.pmdata[i].y);
   markers.push(new BMap.Marker(pt));
}
/*
var MAX = 3;
var markers = [];
var pt = null;
var i = 0;
for (; i < MAX; i++) {
   pt = new BMap.Point(116 + Math.random(), 39 + Math.random());
   markers.push(new BMap.Marker(pt));
}
*/
//最简单的用法，生成一个marker数组，然后调用markerClusterer类即可。
var markerClusterer = new BMapLib.MarkerClusterer(map, {markers:markers});

</script>